# -*- mode: ruby -*-
# vi: set ft=ruby:
 
MEMORY		            	  = 2096
CPUS	      		          = 2
SUBNET                    = "172.16.88."
BOX                       = "bento/ubuntu-20.04"

  #local_disks = [
  #  { :filename => "disk1", :size => DISK_SIZE, :port => 1},
  #  { :filename => "disk2", :size => DISK_SIZE, :port => 2}
  #]

  servers=[
    {
      :hostname => "test1",
      :box => BOX,
      :ip => "#{SUBNET}204",
      :ssh_port => '2220',
      :persistent_data => "~/vagrant/persistent_disk/k8s-master.vdi",
    },
    {
      :hostname => "test2",
      :box => BOX,
      :ip => "#{SUBNET}201",
      :ssh_port => '2221',
      :persistent_data => "~/vagrant/persistent_disk/k8s-node1.vdi",
    }
  ]

Vagrant.configure("2") do |config|

  #disks_directory = File.join(VAGRANT_ROOT, VAGRANT_DISKS_DIRECTORY)

  servers.each do |machine|

    config.vm.define machine[:hostname] do |node|
      node.vm.box = machine[:box]
      node.vm.hostname = machine[:hostname]
      
      node.vm.network :private_network, ip: machine[:ip],
        auto_config: true,
        virtual__intnet: "k8s-net"
      node.vm.network "forwarded_port", guest: 22, host: machine[:ssh_port], id: "ssh"
      host = machine[:hostname]
      node.vm.provider :virtualbox do |v|
        v.customize ["modifyvm", :id, "--memory", MEMORY, "--cpus", CPUS]
        v.customize ["modifyvm", :id, "--name", host]
      end
    end
  end
end
